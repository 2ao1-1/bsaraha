name: 🔍 Debug Deployment

on:
  workflow_dispatch: # Manual trigger only

jobs:
  debug-server:
    runs-on: ubuntu-latest
    steps:
      - name: 🕵️ Debug Server Status
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          script: |
            echo "🖥️ Server Information:"
            echo "📅 Date: $(date)"
            echo "👤 User: $(whoami)"
            echo "📍 Working directory: $(pwd)"

            echo -e "\n🐳 Docker Status:"
            docker --version || echo "Docker not installed"
            docker ps -a || echo "Cannot list containers"

            echo -e "\n💾 Disk Space:"
            df -h

            echo -e "\n🧠 Memory Usage:"
            free -h

            echo -e "\n🔌 Network Ports:"
            netstat -tulpn | grep :3000 || echo "Port 3000 not in use"

            echo -e "\n📋 Running Processes:"
            ps aux | head -10

            echo -e "\n🔍 Docker Images:"
            docker images | head -5

            echo -e "\n📜 Recent Docker Logs (if container exists):"
            docker logs saraha-ui --tail 20 2>/dev/null || echo "No saraha-ui container found"
